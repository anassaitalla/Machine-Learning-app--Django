{% extends 'base.html' %}
{% load static %}


{% block stylesheet %}

<!-- MATERIAL DESIGN ICONIC FONT -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-steps/1.1.0/jquery.steps.css">
</head>
<link rel="stylesheet"
    href="{% static 'colorib/fonts/material-design-iconic-font/css/material-design-iconic-font.css' %}">

<!-- STYLE CSS -->
<!-- <link rel="stylesheet" href="{% static 'colorib/css/style.css' %}"> -->

<style>
    .upload-container {

        background-color: #fff;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-right: 500;
    }

    .upload-header {
        background-color: #1d00f9;
        color: #fff;
        padding: 20px;
        border-radius: 10px 10px 0 0;
    }

    .upload-header h1 {
        margin: 0;
        font-size: 24px;
    }

    .upload-content {
        padding: 20px;
        width: 100%;
    }

    .upload-content p {
        margin: 0 0 10px;
    }

    .upload-drag-drop {
        border: 2px dashed #1d00f9;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        color: #1d00f9;
        background-color: #f1f2f6;
    }

    .form-step {
        display: none;
    }

    .form-step-active {
        display: block;
    }

    .card {
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .card-header {
        background-color: #1d00f9;
        color: #fff;
        border-radius: 10px 10px 0 0;
    }

    .card-title {
        margin: 0;
    }

    .btn {
        border-radius: 20px;
    }

    .btn-primary {
        background-color: #1d00f9;
        border-color: #1d00f9;
    }

    .btn-success {
        background-color: #1d00f9;
        border-color: #1d00f9;
    }

    .btn-secondary {
        background-color: #1d00f9;
        border-color: #1d00f9;
    }

    .model-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
    }

    .card-header {
        font-size: 1.25rem;
        font-weight: bold;
    }

    .chart {
        width: 100%;
        height: 150px;
    }

    .btn-primary {
        margin-right: 10px;
    }
</style>
{% endblock %}




{% block content1 %}
<div class="navbar-menu-wrapper d-flex align-items-top">
    <ul class="navbar-nav">
        <li class="nav-item fw-semibold d-none d-lg-block ms-0">
            <h1 class="welcome-text">Les algorithmes <span class="text-black fw-bold">de Machine Learning</span></h1>
        </li>
    </ul>
</div>

{% endblock %}

{% block content2 %}

<div class="body-container-wrapper w-50 mx-auto ">
    <div class="body-container">
        <div class="upload-container">
            <div class="upload-header text-center">
                <h1>Choisir un fichier</h1>
            </div>
            <div class="stretch-card">
                <div class="card">
                    <div class="card-body" style="height: max-content;">
                        <form id="multiStepForm" action="{% url 'train_model' %}" method="POST">
    
                            <!-- Step 1 -->
                            <div class="form-step form-step-active">
                                <h1 class="card-title">Étape 1 : Sélectionnez Dataset </h1>
                                <div class="col-12 grid-margin stretch-card mt-5 ">
                                    <div class="card">
                                        <div class="card-body">
                                            <p class="card-description"></p>
                                            <div class="input-group w-100">
                                                <select class="form-select" id="file_select" name="file_name">
                                                    <option value="">Choisir un fichier</option>
                                                    {% for file_name in list_file_enregistrement %}
                                                    <option value="{{ file_name }}">{{ file_name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary next-step">Suivant</button>
                            </div>
                            <div class="form-step">
                                <h1 class="card-title">Étape 2 : Selectionnez le cible</h1>
                                <div class="col-12 grid-margin stretch-card mt-5">
                                    <div class="card">
                                        <div class="card-body">
                                            <table class="table table-bordered" id="column_details_table">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th scope="col">Nom de la colonne</th>
                                                        <th scope="col">Valeurs d'exemple</th>
                                                        <th scope="col">Type de colonne</th>
                                                        <th scope="col">Sélection</th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary previous-step">Précédent</button>
                                <button type="button" class="btn btn-primary next-step">Suivant</button>
                            </div>
                            <!-- Step 3 -->
                            <div class="form-step">
                                <h1 class="card-title">Étape 3 : Sélectionnez les caractéristique</h1>
                                <div class="col-12 grid-margin stretch-card mt-5">
                                    <div class="card">
                                        <div class="card-body">
                                            <p class="card-description"></p>
                                            <table class="table table-bordered" id="column_details_table3">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th scope="col">Nom de la colonne</th>
                                                        <th scope="col">Valeurs d'exemple</th>
                                                        <th scope="col">Type de colonne</th>
                                                        <th scope="col">Sélection</th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                {% csrf_token %}
                                <button type="button" class="btn btn-secondary previous-step">Précédent</button>
                                <button type="submit" class="btn btn-success">finaliser et entraîner le modèle</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to fetch and update table content for Step 2
        function updateStep2(file) {
            fetch(`/get_column_details/?file_name=${file}`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#column_details_table tbody');
                    tableBody.innerHTML = ''; // Clear existing rows

                    data.forEach(column => {
                        const row = `
                            <tr>
                                <td>${column.name}</td>
                                <td>${column.example_value}</td>
                                <td>${column.type}</td>
                                <td>
                                    <div class="form-check form-check-primary">
                                        <input type="radio" class="form-check-input" name="target" value="${column.name}">
                                    </div>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(error => console.error('Error fetching column details:', error));
        }

        function updateStep3(file) {
            fetch(`/get_column_details/?file_name=${file}`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#column_details_table3 tbody');
                    tableBody.innerHTML = ''; // Efface les lignes existantes du tableau

                    data.forEach(column => {
                        const row = `
                        <tr>
                            <td>${column.name}</td>
                            <td>${column.example_value}</td>
                            <td>${column.type}</td>
                            <td>
                                <div class="form-check form-check-primary">
                                    <input type="checkbox" class="form-check-input" name="features" value="${column.name}">
                                </div>
                            </td>
                        </tr>
                    `;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(error => console.error('Erreur lors de la récupération des détails de colonne :', error));
        }

        // scripts.js
        let currentStep = 0;
        const steps = document.querySelectorAll('.form-step');

        function showStep(step) {
            steps.forEach((stepElement, index) => {
                stepElement.classList.toggle('form-step-active', index === step);
            });
        }

        document.querySelectorAll('.next-step').forEach(button => {
            button.addEventListener('click', () => {
                if (currentStep === 0) {
                    const selectedFile = document.querySelector('#file_select').value;
                    updateStep2(selectedFile);
                } else if (currentStep === 1) {
                    const selectedFile = document.querySelector('#file_select').value;
                    updateStep3(selectedFile); // Appel pour mettre à jour l'étape 3
                }
                currentStep++;
                if (currentStep >= steps.length) {
                    currentStep = steps.length - 1;
                }
                showStep(currentStep);
            });
        });

        document.querySelectorAll('.previous-step').forEach(button => {
            button.addEventListener('click', () => {
                currentStep--;
                if (currentStep < 0) {
                    currentStep = 0;
                }
                showStep(currentStep);
            });
        });

        showStep(currentStep);

        // document.querySelector('#multiStepForm').addEventListener('submit', function (event) {
        //     event.preventDefault(); // Empêche le comportement de soumission par défaut

        //     // Récupérer les données du formulaire
        //     const formData = new FormData(this);

        //     // Envoyer les données à votre vue Django via fetch
        //     fetch(this.action, {
        //         method: 'POST',
        //         body: formData
        //     })
        //         .then(response => {
        //             if (!response.ok) {
        //                 throw new Error('Network response was not ok');
        //             }
        //             return response.json(); // Si votre vue Django renvoie du JSON
        //         })
        //         .then(data => {
        //             // Traiter la réponse de votre vue Django si nécessaire
        //             console.log('Réponse de la vue Django:', data);
        //             // Redirection ou traitement supplémentaire ici si nécessaire
        //         })
        //         .catch(error => {
        //             console.error('Erreur lors de la soumission du formulaire:', error);
        //             // Gestion des erreurs ici si nécessaire
        //         });
        // });
    });

</script>
{% endblock %}